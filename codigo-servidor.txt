server {
    listen 80;
    listen 443 ssl;
    server_name master-mari-angeles-estepa.test *.master-mari-angeles-estepa.test;

    root "C:/Users/maest/Documents/Github/master-mari-angeles-estepa";
    index index.html index.htm index.php;

    # Compresión
    gzip on;
    gzip_types text/plain application/xml;
    gzip_proxied no-cache no-store private expired auth;
    gzip_min_length 1000;

    # Caching
    location ~* \.(css|js)$ { expires 8M; }
    location ~* \.(xml)$    { expires 20m; }

    # Bloqueo UA
    if ($http_user_agent ~* 'YandexBot') { return 403; }

    # Cabecera global
    add_header X-Asdrubal "Pagina con el SEO revisado por Asdrubal SEO SL";

    # Ruta exacta: bloquear ChatGPT-User
    location = /articulo/estrategias-contenido-seo/ {
        if ($http_user_agent ~* "ChatGPT-User") { return 403; }
        try_files $uri $uri/ /index.php?$args;
    }

    # Prefijo /articulo/ con noindex
    location ^~ /articulo/ {
        add_header X-Robots-Tag "noindex, nofollow" always;
        try_files $uri $uri/ /index.php?$args;
    }

    # Imagen concreta con noindex
    location = /wp-content/uploads/2025/01/contenido-seo.jpg {
        add_header X-Robots-Tag "noindex" always;
        try_files $uri =404;
    }

    # Raíz
    location / {
        try_files $uri $uri/ /index.php?$is_args$args;
        autoindex on;
    }

    # PHP (único bloque)
    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass php_upstream;  # definido por Laragon en php_upstream.conf
    }

    # Utilidades
    location = /favicon.ico { access_log off; log_not_found off; }
    location = /robots.txt  { access_log off; log_not_found off; }
    location ~ /\.ht        { deny all; }

    # SSL local
    ssl_certificate     "C:/laragon/etc/ssl/laragon.crt";
    ssl_certificate_key "C:/laragon/etc/ssl/laragon.key";
    ssl_session_timeout 5m;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv3:+EXP;
    ssl_prefer_server_ciphers on;

    charset utf-8;
}
